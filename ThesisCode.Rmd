---
title: "Thesis Code"
author: "Lewis Hakam"
date: "10/3/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#organizating, filtering, cleaning data
library(plyr)
library(dplyr) #deleted and re installed rlang
library(stats)
library(devtools) #deleted and re installed htmltools
#Movebank data retrieval and manipulation
library(move)
#NMDS dispersal model
library(migrateR) #could not build vignettes. Also used force = T and updated some packages.
#static map
library(ggmap)
library(mapproj)
#interactive maps
library(sp)
library(leaflet)
library(rgdal)
library(raster)
```

### Sign into Movebank 
```{r, echo=FALSE}
loginStored <- movebankLogin(username = "lhaka2", password = "!ShamaJ2016!")
```

### Explore Movebank Data using dplyr
```{r}
getMovebankStudy(study ="Osprey Bierregaard North and South America", login = loginStored) #this provides me with the metadata in the studies page on movebank
Bierregaard_Osprey_summary<-getMovebankReferenceTable(study ="Osprey Bierregaard North and South America", login = loginStored, allAttributes = FALSE) #summary of individuals within the Movebank data
str(Bierregaard_Osprey_summary) #data frame
getMovebankSensorsAttributes(study="Osprey Bierregaard North and South America",login=loginStored) #sensor_type_id for GPS that we will need is 653. 7842954 is the GPS engineering data and 82798	is Argos data.
y<-filter(Bierregaard_Osprey_summary, Bierregaard_Osprey_summary$sensor_type_id == 653) #we only want individuals that have GPS/GSM data. no Doppler shift
y #view the table
table(y$animal_life_stage, y$animal_sex) #summarize further
```

### Load in and map data from Movebank
```{r}
#Download data from Movebank for GPS tracked individuals
Bierregaard_Osprey<-getMovebankData(study ="Osprey Bierregaard North and South America",
                                    animalName = c(y$animal_local_identifier),
                                    login = loginStored, removeDuplicatedTimestamps=TRUE) #This takes some time, but downloads data directly from Movebank. 
str(Bierregaard_Osprey) #perfect!
#plot static map using ggmap
require(mpproj)
Bierregaard_Osprey_DF<-as.data.frame(Bierregaard_Osprey)
m<- get_map(bbox(extent(Bierregaard_Osprey)*1.1), source = "stamen")
ggmap(m) +
  geom_path(data = Bierregaard_Osprey_DF, aes(x=location_long, y=location_lat)) #NICE


#plot interactive map using leaflet - files to large, don't run this code yet...need line files instead of point files...
wgs84<-CRS("+proj=longlat +datum=WGS84") #GCS in WGS 1984
azim_orign = CRS("+proj=aeqd +lat_0=25 +lon_0=-90 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs") #PCS in custom azimuthal equidistant projection
xy<-Bierregaard_Osprey_DF[,c("location_long", "location_lat")]
Bierregaard_Osprey_Projected<-SpatialPointsDataFrame(coords = xy, data = Bierregaard_Osprey_DF,proj4string = azim_orign)
crs(Bierregaard_Osprey_Projected)

leaflet() %>%
  addTiles() %>%
  addMarkers(data = Bierregaard_Osprey_Projected)
```

### References

* Help using the move package to download data from Movebank: <https://cran.r-project.org/web/packages/move/vignettes/browseMovebank.html> 
* Navigating and using data from the move package: <https://cran.r-project.org/web/packages/move/vignettes/move.html>
